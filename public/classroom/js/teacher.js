var studentAnswers={};var ANSWERS=["(A)","(B)","(C)","(D)","(E)","(F)","(G)","(H)","(I)","(J)","(K)"];var $beginAnswer;var $beginExplain;var $whiteBoard;var $endExplain;var currentColor="#f00";var COLORS=["#f00","#00f","#0f0","#ff0"];var currentThick=0.007;var THICKNESSES=[0.007,0.009,0.012,0.015,0.02];function initTeacher(){$(".btn_sh").bind("click",function(){var e=$(this).prev();if(e.is(":visible")){e.hide()}else{e.show()}});$("#checkbox_allpages").bind("click",function(){var e=$(this);if(e.is(":checked")){$("#papers").find("input").prop("checked",true)}else{$("#papers").find("input").attr("checked",false)}});$("#size_button").bind("click",function(g){var f=$("#size_pane");if(f.is(":visible")){f.hide()}else{f.show()}var h;if(g.target.tagName.toLocaleLowerCase()==="span"){h=$(g.target).children("font")}else{if(g.target.tagName.toLocaleLowerCase()==="font"){h=$(g.target)}}if(h){switch(h.attr("class").toLocaleLowerCase()){case"border_1px":currentThick=THICKNESSES[0];break;case"border_3px":currentThick=THICKNESSES[1];break;case"border_5px":currentThick=THICKNESSES[2];break;case"border_10px":currentThick=THICKNESSES[3];break}}});$("#color_button").bind("click",function(g){var f=$("#color_pane");if(f.is(":visible")){f.hide()}else{f.show()}var h;if(g.target.tagName.toLocaleLowerCase()==="span"){h=$(g.target).children("font")}else{if(g.target.tagName.toLocaleLowerCase()==="font"){h=$(g.target)}}if(h){switch(h.attr("class").toLocaleLowerCase()){case"bg_red":currentColor=COLORS[0];break;case"bg_blue":currentColor=COLORS[1];break;case"bg_green":currentColor=COLORS[2];break;case"bg_yellow":currentColor=COLORS[3];break}}});$("#clear_button").bind("click",function(f){clearWhiteBoard()});$beginAnswer=$("#beginAnswer");$beginExplain=$("#beginExplain");$whiteBoard=$("#whiteBoard");$endExplain=$("#endExplain");$beginAnswer.bind("click",function(){var g=$("#papers");if(g.find(":checked").length>0){var e=new Array();g.find("input").each(function(){var h=$(this);if(h.is(":checked")){e.push(parseInt(h.parent().attr("pageIndex")))}else{h.parent().parent().hide()}h.css({visibility:"hidden"})});if(e.length==0){alert("请至少选择一道题")}else{var f=getJsonObject();f.method=ALLTEACHERSENDMETHOD.answer;f.selectPages=e;test_Id=new UUID().id;f.testId=test_Id;ws.send(JSON.stringify(f));select_pages=e;studentAnswers={};goToPage(e[0],true);reloadStudentAnswer();initTeacherAnswer()}}else{alert("请至少选择一道题")}});$beginExplain.bind("click",function(){var e=getJsonObject();e.method=ALLTEACHERSENDMETHOD.explain;e.page=Player.pageIndex;ws.send(JSON.stringify(e));initTeacherExplain()});$endExplain.bind("click",function(){var e=getJsonObject();e.method=ALLTEACHERSENDMETHOD.wait;ws.send(JSON.stringify(e));initTeacherWait()});$whiteBoard.bind("click",function(){var e=getJsonObject();e.method=ALLTEACHERSENDMETHOD.white;if($canvas.is(":visible")){e.bShow=false;$canvas.hide();$whiteBoard.text("显示白板")}else{e.bShow=true;ctxGraphics.clearRect(0,0,width,height);ctxDrawing.clearRect(0,0,width,height);$canvas.show();$whiteBoard.text("隐藏白板")}ws.send(JSON.stringify(e))});function d(g){var f,h;if(g.touches){f=g.touches[0].clientX;h=g.touches[0].clientY}else{f=g.clientX;h=g.clientY}console.log("x="+f+",y="+h);f-=offsetX;f/=width;h-=offsetY;h/=height;return{x:f,y:h}}function c(h){h.preventDefault();$("#size_pane").hide();$("#color_pane").hide();var g=d(h);if(typeof h.button==="number"&&h.button!==0){return}canvas.drawing={type:"path",color:currentColor,width:currentThick,points:[g]};var f=getJsonObject();f.method=ALLTEACHERSENDMETHOD.path_down;f.x=g.x;f.y=g.y;f.color=currentColor;f.thickness=currentThick;ws.send(JSON.stringify(f))}function b(i){i.preventDefault();var f=canvas.drawing;if(!f||f.type!=="path"){return}var h=d(i);f.points.push(h);var g=getJsonObject();g.method=ALLTEACHERSENDMETHOD.path_move;g.x=h.x;g.y=h.y;ws.send(JSON.stringify(g));redrawDrawing()}function a(j){j.preventDefault();var f=canvas.drawing;if(!f||f.type!=="path"){return}if(!j.touches){f.points.push(d(j))}var h=f.points.length;var i=f.points[h-1];canvas.graphics.push(f);canvas.history=[];drawPath(ctxGraphics,f);var g=getJsonObject();g.method=ALLTEACHERSENDMETHOD.path_up;g.x=i.x;g.y=i.y;ws.send(JSON.stringify(g));canvas.drawing=null;redrawDrawing()}$drawing.addEventListener("mousedown",c);$drawing.addEventListener("mousemove",b);$drawing.addEventListener("mouseup",a);$drawing.addEventListener("touchstart",c);$drawing.addEventListener("touchmove",b);$drawing.addEventListener("touchend",a)}function dealTeacherMessage(d){switch(d.method){case ALLMETHOD.init:switch(d.mode){case ALLMODE.teacher_offline:initTeacherWait();break;case ALLMODE.wait_teacher_distribute:initTeacherWait();break;case ALLMODE.student_answer:test_Id=d.testId;select_pages=d.selectPages;studentAnswers=d.testData;initTeacherAnswer();break;case ALLMODE.teacher_speak:select_pages=d.selectPages;current_Page=d.currentPage;studentAnswers=d.testData;initTeacherExplain();break}break;case ALLTEACHERRECEIVEMETHOD.online:var c=$("#online_students");c.children().remove();var f=0;var a=0;for(var b in d.students){f++;var e=d.students[b];if(e.status==0){c.append('<li id="studentCode'+e.code+'"><img src="/public/classroom/images/ic_dele.png" width="13" height="13"/>'+e.name+'<span style="visibility: hidden" class="wrong">(B)</span></li>')}else{a++;c.append('<li id="studentCode'+e.code+'"><img src="/public/classroom/images/ic_online.png" width="13"  height="13"/>'+e.name+'<span style="visibility: hidden" class="correct">(C)</span></li>')}}$("#online_students_num").text("在线人数："+a+"/"+f);reloadStudentAnswer();break;case ALLTEACHERRECEIVEMETHOD.answer:studentAnswers[d.studentCode]=d.data;reloadStudentAnswer();break;default:break}}function initTeacherWait(){delete select_pages;classMode=ALLMODE.wait_teacher_distribute;$("#layout1").show();$("#layout2").hide();$("#layout3").hide();$canvas.hide();$whiteBoard.text("显示白板");var b=$("#papers");b.find("input").each(function(){var c=$(this);c.parent().parent().show();c.css({visibility:"visible"})});var a=getJsonObject();a.method=ALLTEACHERSENDMETHOD.white;a.bShow=false;ws.send(JSON.stringify(a))}function initTeacherReview(a){select_pages=a.selectPages;studentAnswers=a.testData;initTeacherAnswer();$("#layout2").hide();a.method=ALLTEACHERRECEIVEMETHOD.online;dealTeacherMessage(a)}function initTeacherAnswer(){classMode=ALLMODE.student_answer;$("#layout1").hide();$("#layout2").show();$("#layout3").hide();$canvas.hide();$whiteBoard.text("显示白板");reloadTeacherSelectPage()}function initTeacherExplain(){classMode=ALLMODE.teacher_speak;$("#layout1").hide();$("#layout2").hide();$("#layout3").show();$canvas.hide();$whiteBoard.text("显示白板");reloadTeacherSelectPage(current_Page);var a=getJsonObject();a.method=ALLTEACHERSENDMETHOD.change_page;a.page=Player.pageIndex;ws.send(JSON.stringify(a))}function clearWhiteBoard(){ctxGraphics.clearRect(0,0,width,height);ctxDrawing.clearRect(0,0,width,height);var a=getJsonObject();a.method=ALLTEACHERSENDMETHOD.path_clear;ws.send(JSON.stringify(a))}function reloadTeacherSelectPage(d){var c=$("#papers");var a={};for(var b=0;b<select_pages.length;b++){if(b==0){if(typeof(d)!="undefined"){goToPage(parseInt(d),true)}else{goToPage(parseInt(select_pages[b]),true)}}a[parseInt(select_pages[b])]=parseInt(select_pages[b])}c.find("input").each(function(){var f=$(this);var e=parseInt(f.parent().attr("pageIndex"));if(typeof(a[e])!="undefined"){f.prop("checked",true);f.parent().parent().show()}else{f.attr("checked",false);f.parent().parent().hide()}f.css({visibility:"hidden"})});reloadStudentAnswer()}function reloadStudentAnswer(){var c=$("#online_students");c.find("span").css({visibility:"hidden"});for(var b in studentAnswers){if(studentAnswers[b]){var f=studentAnswers[b].subjectData.data.data[Player.pageIndex].data[0];var a=c.children("#studentCode"+b);if(a){if(f){if(f.userAnswer.length>1){if(f.userAnswer[0]=="org.neworiental.rmp.base::OptionGroup"){var d=a.children("span");var g=parseInt(f.userAnswer[1]);var e=parseInt(f.rightAnswer[0]);d.css({visibility:"visible"});d.attr("class",g==e?"correct":"wrong");d.text(ANSWERS[g])}}}}}}};