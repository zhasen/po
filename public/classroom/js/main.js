$(function(){initElement();if(role==ALLROLL.student){initStudent()}else{if(role==ALLROLL.teacher){initTeacher()}}testing_callback=function(b){switch(b.method){case TESTING_CALLBACK_METHOD.loadData:if(!paperConfig.testId||paperConfig.testId.length==0){ws=new WebSocket("ws://path.xdf.cn");ws.onopen=function(){console.log("socket open");var g=getJsonObject();g.method=ALLMETHOD.init;ws.send(JSON.stringify(g))};ws.onclose=function(g){console.log("socket close")};ws.onmessage=function(h){console.log(h.data);var g=JSON.parse(h.data);if(g.method==ALLMETHOD.init){classMode=g.mode}if(role==ALLROLL.student){dealStudentMessage(g)}else{if(role==ALLROLL.teacher){dealTeacherMessage(g)}}}}else{$.ajax({url:"answer-get?testId="+paperConfig.testId+"&role="+role,success:function(g){console.log(g);if(role==ALLROLL.student){initStudentReview(g)}else{if(role==ALLROLL.teacher){initTeacherReview(g)}}},error:function(){}})}if(Testing.paper.structItem.trees.length>0){var e=$("#papers");e.children().remove();for(var d=1;d<=Player.subjectList.pages.length;d++){if(role==ALLROLL.student){e.append('<li><span id="page_span'+(d-1)+'" pageIndex="'+(d-1)+'"><input style="visibility:hidden" type="checkbox" name="checkbox" id="page_checkbox'+d+'" class="cbox" /> 第'+d+"页</span></li>")}else{if(role==ALLROLL.teacher){e.append('<li><span id="page_span'+(d-1)+'" pageIndex="'+(d-1)+'"><input type="checkbox" name="checkbox" id="page_checkbox'+d+'" class="cbox" /> 第'+d+"页</span></li>")}}}if(role==ALLROLL.teacher){e.bind("click",function(h){if(h.target.tagName.toLocaleLowerCase()==="span"){var g=$(h.target);goToPage(g.attr("pageIndex"),true);reloadStudentAnswer();a(g.attr("pageIndex"))}})}if(select_pages&&select_pages.length>0){if(classMode==ALLMODE.student_answer){if(role==ALLROLL.student){initStudentAnswer()}else{if(role==ALLROLL.teacher){initTeacherAnswer()}}}else{if(classMode==ALLMODE.teacher_speak){if(role==ALLROLL.student){initStudentExplain()}else{if(role==ALLROLL.teacher){initTeacherExplain()}}}}}}goToPage(0,false);break;case TESTING_CALLBACK_METHOD.getPageNumber:if(select_pages&&select_pages.length>0){for(var d=0;d<select_pages.length;d++){if(select_pages[d]==b.currentPage){if(b.orientation=="next"){if(d==select_pages.length-1){return -1}else{goToPage(select_pages[d+1],false);a(select_pages[d+1]);return select_pages[d+1]}}else{if(b.orientation=="back"){if(d==0){goToPage(select_pages[d],false);a(select_pages[d]);return select_pages[d]}else{goToPage(select_pages[d-1],false);a(select_pages[d-1]);return select_pages[d-1]}}}return b.currentPage}}}else{if(b.orientation=="next"){var f=b.currentPage+1;if(f<Player.subjectList.pages.length){goToPage(f,false)}}else{var f=b.currentPage-1;if(f>=0){goToPage(f,false)}}}break;case TESTING_CALLBACK_METHOD.sendAnswer:if(role==ALLROLL.student){var c=getJsonObject();c.method=ALLSTUDENTSENDMETHOD.answer;c.data=b.data;c.paperName=Testing.paper.paperName;c.testId=test_Id;ws.send(JSON.stringify(c))}break}};function a(c){if(role==ALLROLL.teacher&&classMode==ALLMODE.teacher_speak){var b=getJsonObject();b.method=ALLTEACHERSENDMETHOD.change_page;b.page=c;ws.send(JSON.stringify(b))}}});