var ALLWSTYPE={classRoom:"ClassRoom"};var ALLMETHOD={init:"init",close:"close"};var ALLTEACHERRECEIVEMETHOD={online:"teacher_receive_online_student",answer:"teacher_receive_student_answer"};var ALLTEACHERSENDMETHOD={offline:"teacher_send_offline",wait:"teacher_send_wait",answer:"teacher_send_answer",explain:"teacher_send_explain",white:"teacher_send_white",path_down:"teacher_send_path_down",path_move:"teacher_send_path_move",path_up:"teacher_send_path_up",path_clear:"teacher_send_path_clear",change_page:"teacher_send_change_page"};var ALLSTUDENTRECEIVEMETHOD={offline:"student_receive_offline",wait:"student_receive_wait",answer:"student_receive_answer",explain:"student_receive_explain",white:"student_receive_white",path_down:"student_receive_path_down",path_move:"student_receive_path_move",path_up:"student_receive_path_up",path_clear:"student_receive_path_clear",change_page:"student_receive_change_page"};var ALLSTUDENTSENDMETHOD={answer:"student_send_answer"};var ALLROLL={student:1,teacher:2};var ALLMODE={teacher_offline:1,wait_teacher_distribute:2,student_answer:3,teacher_speak:4};var canvas,width,height,offsetX,offsetY;var $canvas,$drawing,$graphics;var ctxGraphics,ctxDrawing;var select_pages;var classMode;var current_Page;var test_Id;function getJsonObject(){var a={};a.type=ALLWSTYPE.classRoom;a.role=role;a.userId=userId;a.classCode=classCode;a.schoolId=schoolId;a.pType=pType;return a}function initElement(){$canvas=$("#canvas");$drawing=$("#drawing")[0];$graphics=$("#graphics")[0];ctxGraphics=$graphics.getContext("2d");ctxDrawing=$drawing.getContext("2d");canvas={graphics:[],history:[],drawing:null};var a=window.onresize;window.onresize=function(){var f,b,e,c;f=b=e=c=2;f=85;c=188;width=window.innerWidth-c;height=window.innerHeight-f-5;if(width==0||height==0){return}offsetX=e;offsetY=f;function d(g){g.width=width;g.height=height;g.style.width=width+"px";g.style.height=height+"px";g.style.left=offsetX+"px";g.style.top=offsetY+"px"}d($canvas[0]);offsetX=0;offsetY=0;d($drawing);d($graphics);offsetX=e;offsetY=f;redrawGraphics();redrawDrawing();$("#papers").height(window.innerHeight-40);if(a){a()}};window.onresize()}function redrawGraphics(){var a=ctxGraphics;a.clearRect(0,0,width,height);a.save();a.globalCompositeOperation="destination-over";for(var b=canvas.graphics.length-1;b>=0;--b){var c=canvas.graphics[b];if(c.type==="clear"){break}else{if(c.type==="path"){drawPath(a,c)}}}a.restore()}function redrawDrawing(){ctxDrawing.clearRect(0,0,width,height);if(!canvas.drawing){return}drawPath(ctxDrawing,canvas.drawing)}function drawPath(a,b){var d=b.points;if(d.length<=1){return}a.save();a.lineCap="round";a.lineWidth=b.width*width;a.strokeStyle=b.color;a.beginPath();a.moveTo(d[0].x*width,d[0].y*height);for(i=1;i<d.length-2;i++){var c=(d[i].x+d[i+1].x)/2*width;var e=(d[i].y+d[i+1].y)/2*height;a.quadraticCurveTo(d[i].x*width,d[i].y*height,c,e)}if(d.length>=3){a.quadraticCurveTo(d[i].x*width,d[i].y*height,d[i+1].x*width,d[i+1].y*height)}a.stroke();a.restore()}function goToPage(b,c){b=parseInt(b);if(c===true){Player.pageIndex=b;Player.play()}var a=$("#papers");a.children().removeClass("selected_test");a.find("#page_span"+b).parent().addClass("selected_test")};