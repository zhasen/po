function UUID(){this.id=this.createUUID()}UUID.prototype.valueOf=function(){return this.id};UUID.prototype.toString=function(){return this.id};UUID.prototype.createUUID=function(){var d=new Date(1582,10,15,0,0,0,0);var g=new Date();var j=g.getTime()-d.getTime();var b="";var k=UUID.getIntegerBits(j,0,31);var i=UUID.getIntegerBits(j,32,47);var f=UUID.getIntegerBits(j,48,59)+"1";var c=UUID.getIntegerBits(UUID.rand(4095),0,7);var e=UUID.getIntegerBits(UUID.rand(4095),0,7);var a=UUID.getIntegerBits(UUID.rand(8191),0,7)+UUID.getIntegerBits(UUID.rand(8191),8,15)+UUID.getIntegerBits(UUID.rand(8191),0,7)+UUID.getIntegerBits(UUID.rand(8191),8,15)+UUID.getIntegerBits(UUID.rand(8191),0,15);return(k+b+i+b+f+b+c+e+b+a).toLowerCase()};UUID.getIntegerBits=function(f,g,b){var a=UUID.returnBase(f,16);var d=new Array();var e="";var c=0;for(c=0;c<a.length;c++){d.push(a.substring(c,c+1))}for(c=Math.floor(g/4);c<=Math.floor(b/4);c++){if(!d[c]||d[c]==""){e+="0"}else{e+=d[c]}}return e};UUID.returnBase=function(c,d){var e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];if(c<d){var b=e[c]}else{var f=""+Math.floor(c/d);var a=c-f*d;if(f>=d){var b=this.returnBase(f,d)+e[a]}else{var b=e[f]+e[a]}}return b};UUID.rand=function(a){return Math.floor(Math.random()*a)};function Designer(){var a=this;this.config={target:null,status:"template",pageHeight:500,imgPath:"",audioPath:"",audioImgPath:"",statusType:"normal"};this.canvas=null;this.initialize=function(b){$.extend(true,this.config,b);$(document).bind("selectstart",function(){return false});if(this.config.status=="template"){$(".template_toolbar").children(".bar").unbind().bind("mousedown",function(i){var g=$(this).attr("n");var j=null;var h=null;var d=null;var c=-1;var f;$(document).bind("mousemove",function(l){if(j==null){j=a.model.create(g);h=a.renderSubject(j,true)}d=a.utils.getRelativePos(l.pageX,l.pageY,a.config.target);h.css({left:d.x,top:d.y});c=-1;f=-1;var m=null;a.config.target.find(".designer_canvas").each(function(){var r=$(this);if(!r.is(":visible")){return true}var v={x:r.offset().left,y:r.offset().top,w:r.width(),h:r.height()};var w=l.pageY-r.offset().top;if(a.utils.pointInRect(l.pageX,l.pageY,v)){c=parseInt(r.attr("pindex"));m=r;var o=a.model.define.containers[c].contents;for(var s=0;s<o.length;s++){var p=o[s];var q=a.config.target.find(".subject_box#"+p.ID);var t=parseInt(p.topDis);if(s==0&&w<=t){f=s;break}if(s<o.length-1){t=q.position().top+t;var u=o[s+1];var n=t+q.height()+parseInt(u.topDis);if(w>t&&w<=n){f=s+1;break}}}return false}});$(".insert_line").remove();if(c!=-1){var e=$("<div class='insert_line'></div>");if(f!=-1){var k=a.model.define.containers[c].contents[f].topDis;k=parseInt(k);e.height(k/2);if(f==0){m.prepend(e)}else{m.children(".subject_box:eq("+(f-1)+")").after(e)}}else{m.append(e)}}});$(document).bind("mouseup",function(e){$(".insert_line").remove();a.config.target.find(".designer_canvas").unbind("mouseenter").unbind("mouseleave");$(document).unbind("mousemove");$(document).unbind("mouseup");if(d!=null){h.remove();if(c!=-1){a.model.add(j,c,f);a.renderSubject(j,false,f)}}})});this.config.target.on("mouseenter",".subject_canvas",function(){var d=$(this).parent();var f=d.attr("id");if(d.hasClass("subject_creating")){return}$(".subject_operate").remove();var c=$("<div class='subject_operate'></div>").appendTo($(this));var e=$("<div class='tpbtn subject_op_btn'>删除</div>").appendTo(c);e.bind("click",function(){d.remove();a.model.remove(f)})});this.config.target.on("mouseleave",".subject_canvas",function(){$(".subject_operate").remove()});this.config.target.on("click",".subject_canvas",function(c){c.stopPropagation();$(".subject_selected").removeClass("subject_selected");$(this).addClass("subject_selected")});this.config.target.bind("keydown",function(g){var d=a.config.target.find(".subject_selected");if(d.length>0&&g.keyCode>=37&&g.keyCode<=40){var h=d.parent().attr("id");var c=a.model.getById(h);if(g.keyCode==37){c.leftDis=parseInt(c.leftDis);c.leftDis-=5;if(c.leftDis<0){c.leftDis=0}c.leftDis+=""}else{if(g.keyCode==39){c.leftDis=parseInt(c.leftDis);c.leftDis+=5;if(c.leftDis>100){c.leftDis=100}c.leftDis+=""}else{if(g.keyCode==38){c.topDis=parseInt(c.topDis);c.topDis-=5;if(c.topDis<0){c.topDis=0}c.topDis+=""}else{if(g.keyCode==40){c.topDis=parseInt(c.topDis);c.topDis+=5;if(c.topDis>200){c.topDis=200}c.topDis+=""}}}}a.renderSubject(c);$(".position_tip").remove();var f=$("<div class='position_tip'></div>").appendTo(d.parent());f.text("左边距："+c.leftDis+" 上边距："+c.topDis);a.config.target.bind("keyup",function(){$(".position_tip").fadeOut();a.config.target.unbind("keyup")})}}).bind("click",function(){$(".subject_selected").removeClass("subject_selected")})}else{if(this.config.status=="subject"){this.config.target.on("mouseenter",".subject_canvas",function(){var h=$(this).parent();if(h.hasClass("subject_creating")){return}var j=h.attr("id");$(".subject_operate").remove();var g=a.model.getById(j);var e=g.className;var d=$("<div class='subject_operate'></div>").appendTo($(this));if(e=="org.neworiental.rmp.base::BaseRichTxt"){var f=$("<div class='tpbtn subject_op_btn'>编辑</div>").appendTo(d);f.bind("click",function(){$(".editor_toolbar").children(".insert_rect").hide();$(".editor_toolbar").children(".insert_arrow").hide();$(".editor_toolbar").children(".insert_blank").hide();$("#txt_edit_text").qeditor("setValue",g.htmlText);$("#dlg_edit_text").dlg();$("#btn_save_text").unbind().bind("click",function(){g.htmlText=$("#txt_edit_text").val();a.renderSubject(g);$("#dlg_edit_text").dlg("close");a.model.update(g)})})}else{if(e=="org.neworiental.rmp.base::BaseTLFText"){var f=$("<div class='tpbtn subject_op_btn'>编辑</div>").appendTo(d);f.bind("click",function(){$(".editor_toolbar").children(".insert_rect").show();$(".editor_toolbar").children(".insert_arrow").show();$(".editor_toolbar").children(".insert_blank").hide();$("#txt_edit_text").qeditor("setValue",decodeURIComponent(g.text));$("#dlg_edit_text").dlg();$("#btn_save_text").unbind().bind("click",function(){g.text=decodeURIComponent($("#txt_edit_text").val());a.renderSubject(g);$("#dlg_edit_text").dlg("close");a.model.update(g)})})}else{if(e=="org.neworiental.rmp.base::BasePicture"||e=="org.neworiental.rmp.base::BaseAudio"){d.append("<div class='subject_op_chk'><input type='checkbox' class='chk'/>是否居中</div>");var c=d.find("input");if(g.isCenter=="true"){c.attr("checked",true)}c.bind("click",function(){var k=$(this).is(":checked");var l=a.model.getById(j);l.isCenter=k+"";a.renderSubject(l);a.model.update(l)})}else{if(e=="org.neworiental.rmp.base::BaseVideo"){d.append("<div class='tpbtn subject_op_btn'>编辑</div><div class='subject_op_chk'><input type='checkbox' class='chk'/>是否居中</div>");var c=d.find("input");if(g.isCenter=="true"){c.attr("checked",true)}c.bind("click",function(){var k=$(this).is(":checked");var l=a.model.getById(j);l.isCenter=k+"";a.renderSubject(l);a.model.update(l)});d.find(".subject_op_btn").bind("click",function(){$("#dlg_edit_video").dlg();$("#edit_video_w").val(g.vWidth).focus();$("#edit_video_h").val(g.vHeight);$("#btn_save_video_edit").unbind().bind("click",function(){var k=$("#edit_video_w").val();var l=$("#edit_video_h").val();if(k&&l){g.vWidth=k;g.vHeight=l;a.renderSubject(g);a.model.update(g)}$("#dlg_edit_video").dlg("close")})})}else{if(e=="org.neworiental.rmp.base::TOEFLRecord"){d.append("<div class='tpbtn subject_op_btn'>编辑</div><div class='subject_op_chk'><input type='checkbox' class='chk'/>是否居中</div>");var c=d.find("input");if(g.isCenter=="true"){c.attr("checked",true)}c.bind("click",function(){var k=$(this).is(":checked");var l=a.model.getById(j);l.isCenter=k+"";a.renderSubject(l);a.model.update(l)});var f=d.find(".subject_op_btn");f.bind("click",function(){$("#dlg_edit_record").dlg();$("#edit_record_time").val(g.time);$("#btn_save_record_edit").unbind().bind("click",function(){var k=$("#edit_record_time").val();if(k){g.time=k}a.renderSubject(g);$("#dlg_edit_record").dlg("close");a.model.update(g)})})}else{if(e=="org.neworiental.rmp.base::OptionGroup"){d.append("<div class='tpbtn subject_op_btn'>编辑</div><div class='subject_op_chk'><input type='checkbox' class='chk'/>是否居中</div>");var c=d.find("input");if(g.isCenter=="true"){c.attr("checked",true)}c.bind("click",function(){var k=$(this).is(":checked");var l=a.model.getById(j);l.isCenter=k+"";a.renderSubject(l);a.model.update(l)});var f=d.find(".subject_op_btn");f.bind("click",function(){var m="";if(g.options){for(var l=0;l<g.options.length;l++){var k=g.options[l];if(l!=0){m+="\n"}m+=a.utils.toText(k.htmlText)}}$("#dlg_edit_select").dlg();$("#edit_select_text").val(m).focus();if(g.isMult=="true"){$("#edit_select_multi").attr("checked",true)}else{$("#edit_select_multi").attr("checked",false)}$("#btn_save_select_edit").unbind().bind("click",function(){var o=$("#edit_select_text").val().split("\n");var n=[];for(var p=0;p<o.length;p++){var q=o[p];n.push({horizentalCenter:"NaN",className:"org.neworiental.rmp.base::BaseRichTxt",verticalCenter:"NaN",topDis:"NaN",rightDis:"0",ID:"",htmlText:q,leftDis:"30",isNode:"false",bottomDis:"NaN"})}g.options=n;g.isMult=$("#edit_select_multi").is(":checked")+"";g.rightAns="[]";a.renderSubject(g);$("#dlg_edit_select").dlg("close");a.model.update(g)})})}else{if(e=="write"){var f=$("<div class='tpbtn subject_op_btn'>编辑</div>").appendTo(d);f.bind("click",function(){$("#dlg_edit_write").dlg();$("#edit_write_placeholder").val(g.placeholder);$("#edit_write_h").val(g.minHeight);if(g.showCount){$("#edit_write_count").attr("checked",true)}else{$("#edit_write_count").attr("checked",false)}$("#btn_save_write_edit").unbind().bind("click",function(){g.placeholder=$("#edit_write_placeholder").val();var k=parseInt($("#edit_write_h").val());if(k){g.minHeight=k}g.showCount=$("#edit_write_count").is(":checked");a.renderSubject(g);$("#dlg_edit_write").dlg("close");a.model.update(g)})})}else{if(e=="org.neworiental.rmp.base::TOEFLTimerViewer"){d.append("<div class='tpbtn subject_op_btn'>编辑</div><div class='subject_op_chk'><input type='checkbox' class='chk'/>是否居中</div>");var c=d.find("input");if(g.isCenter=="true"){c.attr("checked",true)}c.bind("click",function(){var k=$(this).is(":checked");var l=a.model.getById(j);l.isCenter=k+"";a.renderSubject(l);a.model.update(l)});var f=d.find(".subject_op_btn");f.bind("click",function(){$("#dlg_edit_timer").dlg();$("#edit_timer_title").val(g.title).focus();$("#edit_timer_time").val(g.time);$("#btn_save_timer_edit").unbind().bind("click",function(){g.title=$("#edit_timer_title").val();var k=parseInt($("#edit_timer_time").val());if(k){g.time=$("#edit_timer_time").val()}a.renderSubject(g);$("#dlg_edit_timer").dlg("close");a.model.update(g)})})}else{if(e=="tableselect"){d.append("<div class='tpbtn subject_op_btn'>编辑</div><div class='subject_op_chk'><input type='checkbox' class='chk'/>是否居中</div>");var c=d.find("input");if(g.center){c.attr("checked",true)}c.bind("click",function(){var k=$(this).is(":checked");var l=a.model.getById(j);l.center=k;a.renderSubject(l);a.model.update(l)});var f=d.find(".subject_op_btn");f.bind("click",function(){$("#dlg_edit_table").dlg();$("#edit_table_column_text").val(g.columns.join("\n"));$("#edit_table_row_text").val(g.rows.join("\n"));$("#btn_save_table_edit").unbind().bind("click",function(){var l=$("#edit_table_row_text").val().split("\n");var k=$("#edit_table_column_text").val().split("\n");g.columns=k;g.rightAnswer=[];g.rows=l;a.renderSubject(g);$("#dlg_edit_table").dlg("close");a.model.update(g)})})}else{if(e=="drag"){d.append("<div class='tpbtn subject_op_btn'>编辑</div>");var f=d.find(".subject_op_btn");f.bind("click",function(){$("#edit_drag_blanks").empty();for(var k=0;k<g.blanks.length;k++){var m=g.blanks[k];var l=$("<div class='edit_drag_blank'>题空个数：<input type='text' class='txt edit_drag_blank_size'/>描述：<input type='text' class='txt edit_drag_blank_des'/></div>").appendTo("#edit_drag_blanks");l.children(".edit_drag_blank_size").val(m.size);l.children(".edit_drag_blank_des").val(m.description);if(k!=0){l.append("<div class='tpbtn default delete_btn'>删除</div>")}}$("#dlg_edit_drag").dlg();$("#edit_drag_options").val(g.options.join("\n")).focus();$("#edit_drag_add").unbind().bind("click",function(){var n=$("<div class='edit_drag_blank'>题空个数：<input type='text' value='1' class='txt edit_drag_blank_size'/>描述：<input type='text' class='txt edit_drag_blank_des'/><div class='tpbtn default delete_btn'>删除</div></div>").appendTo("#edit_drag_blanks")});$("#edit_drag_blanks").on("click",".delete_btn",function(){$(this).parent().remove()});$("#btn_save_drag_edit").unbind().bind("click",function(){var n=$("#edit_drag_options").val().split("\n");g.options=n;var o=[];$(".edit_drag_blank").each(function(){var q=$(this).children(".edit_drag_blank_size");var p=parseInt(q.val());if(!p){p=1}var r=$(this).children(".edit_drag_blank_des").val();var s={size:p,description:r};o.push(s)});g.rightAnswer=[];g.blanks=o;a.renderSubject(g);$("#dlg_edit_drag").dlg("close");a.model.update(g)})})}else{if(e=="fillblank"){var f=$("<div class='tpbtn subject_op_btn'>编辑</div>").appendTo(d);f.bind("click",function(){$(".editor_toolbar").children(".insert_rect").hide();$(".editor_toolbar").children(".insert_arrow").hide();$(".editor_toolbar").children(".insert_blank").show();$("#txt_edit_text").qeditor("setValue",g.text);$("#dlg_edit_text").dlg();$("#btn_save_text").unbind().bind("click",function(){g.text=$("#txt_edit_text").val();a.renderSubject(g);$("#dlg_edit_text").dlg("close");a.model.update(g)})})}else{if(e=="audiotext"){d.append("<div class='tpbtn subject_op_btn'>编辑</div>");var f=d.find(".subject_op_btn");f.bind("click",function(){$("#audiotext_points").empty();$("#dlg_edit_audiotext").dlg({modal:false});var l=document.getElementById("audiotext_edit_player");function k(r,t){var s=$("<div></div>").appendTo("#audiotext_points");var q=207;var p=Math.floor(r.time/t*q);s.css("left",p);if(r.type=="text"){s.attr("title",r.text)}if(r.type=="end"){s.addClass("point_type_end")}else{s.addClass("image_dropable point_type_normal")}s.data("props",r);$("#audiotext_points").children("div").unbind("dblclick").bind("dblclick",function(u){if(confirm("确定删除该锚点？")){$(this).remove()}});$("#audiotext_points").children(".point_type_normal").unbind("mouseenter").bind("mouseenter",function(x){var w=$(this);var v=$("#autiotext_point_tip");if(v.length==0){v=$("<div id='autiotext_point_tip'></div>").appendTo("body")}v.empty();var u=w.data("props");if(u.image){v.append("<img src='"+u.image+"'/>")}v.append("<div>"+u.text+"</div>");v.show().css({left:w.offset().left,top:w.offset().top+20})});$("#audiotext_points").children(".point_type_normal").unbind("mouseleave").bind("mouseleave",function(u){$("#autiotext_point_tip").hide()});$("#audiotext_points").children("div").unbind("mousedown").bind("mousedown",function(w){var v=$(this);var u=w.pageX-v.offset().left;$(document).bind("mousemove",function(y){var x=y.pageX-$("#audiotext_points").offset().left;var z=x-u;if(z<0){z=0}else{if(z>q){z=q}}v.css("left",z)});$(document).bind("mouseup",function(y){$(document).unbind("mouseup");$(document).unbind("mousemove");var A=v.position().left;var z=Math.floor(A/q*t);var x=v.data("props");x.time=z})})}if(g.src){var m=g.points;if(!m){m=[]}for(var o=0;o<m.length;o++){var n=m[o];k(n,g.duration)}$("#audiotext_edit_player").attr("src",g.src)}$("#audiotext_text_btn").unbind().bind("click",function(){if(!$("#audiotext_edit_player").attr("src")){alert("音频尚未加载，请先从资源栏中添加音频");return}if(!l.duration){alert("音频正在加载中，请稍候操作");return}var r=$("#audiotext_text").val();if(r==""){$("#audiotext_text").focus();return}$("#audiotext_text").val("");var q=l.currentTime;var p={type:"text",time:Math.floor(q),text:r};k(p,l.duration)});$("#audiotext_add_endpoint").unbind().bind("click",function(){if(!$("#audiotext_edit_player").attr("src")){alert("音频尚未加载，请先从资源栏中添加音频");return}if(!l.duration){alert("音频正在加载中，请稍候操作");return}var q=l.currentTime;var p={type:"end",time:Math.floor(q)};k(p,l.duration)});$("#btn_save_audiotext_edit").unbind().bind("click",function(){var p=[];$("#audiotext_points").children("div").each(function(){var q=$(this).data("props");p.push(q)});g.points=p;g.src=$("#audiotext_edit_player").attr("src");if(l.duration&&l.duration!=g.duration){g.duration=Math.floor(l.duration)}a.renderSubject(g);$("#dlg_edit_audiotext").dlg("close");a.model.update(g);$("#audiotext_edit_player").attr("src","")})})}else{if(e=="record_test"){d.append("<div class='subject_op_chk'><input type='checkbox' class='chk'/>是否居中</div>");var c=d.find("input");if(g.center){c.attr("checked",true)}c.bind("click",function(){var k=$(this).is(":checked");var l=a.model.getById(j);l.center=k;a.renderSubject(l);a.model.update(l)})}}}}}}}}}}}}}if(g.resource){var i=$("<div class='tpbtn subject_op_btn'>删除</div>").prependTo(d);i.bind("click",function(){h.remove();a.model.remove(j)})}});this.config.target.on("mouseleave",".subject_canvas",function(){$(".subject_operate").remove()})}}};this.renderSubject=function(h,e,M){var k;if(e){k=this.config.target.find(".subject_creating")}else{k=this.config.target.find(".subject_box#"+h.ID)}var f=null;if(k.length==0){if(e){k=$("<div class='subject_box subject_creating'><div class='subject_canvas'></div></div>").appendTo(this.config.target)}else{var d=this.model.getSubContainerIndex(h.ID);var b=this.config.target.find(".designer_canvas:eq("+d+")");f=this.model.define.containers[d].contents;var g="<div class='subject_box' id='"+h.ID+"'><div class='subject_canvas'></div></div>";if(typeof M=="undefined"||M==-1||M>=f.length){k=$(g).appendTo(b)}else{if(M==0){k=$(g).prependTo(b)}else{b.children(".subject_box:eq("+(M-1)+")").after(g);k=b.find(".subject_box#"+h.ID)}}}}k.attr("n",h.className);var l=k.children(".subject_canvas");if(this.config.status=="readonly"||this.config.status=="testing"){l.addClass("subject_canvas_readonly")}if(h.className=="org.neworiental.rmp.base::BaseRichTxt"){l.html(a.utils.formatHtml(h.htmlText))}else{if(h.className=="org.neworiental.rmp.base::BaseTLFText"){var E=decodeURIComponent(h.text);l.html(a.utils.formatHtml(E));if(f!=null&&f.length==1&&this.model.define.containers.length==2){var H=l.find(".richtext_arrow");if(H.length>0){var j=H.position().top;k.parent().parent().scrollTop(j)}}}else{if(h.className=="org.neworiental.rmp.base::ToelfInsertPart"){var E=decodeURIComponent(h.data);l.html(a.utils.formatHtml(E));var S=l.find(".richtext_rect");var Y=0;S.each(function(){$(this).attr("ind",Y);Y++});var o=a.config.status=="testing"&&a.config.statusType=="review";if(!o){S.bind("click",function(){l.find(".richtext_rect").show().removeClass("inserted");l.find(".inserted_text").remove();$(this).after("<span class='inserted_text' style='color: blue'>"+h.showText+"</span>");$(this).hide().addClass("inserted")})}if(f!=null&&f.length==1&&this.model.define.containers.length==2){var H=l.find(".richtext_arrow");if(H.length>0){var j=H.position().top;k.parent().parent().scrollTop(j)}}if(a.config.status=="testing"&&Player.pageAnswer&&Player.pageAnswer.length>0){var n=Player.pageAnswer[0];var n=Player.getSubjectAnswer(Player.pageAnswer,a.model.define,h);if(n.length>1){l.find(".richtext_rect[ind="+n[1]+"]").hide().addClass("inserted");l.find(".richtext_rect[ind="+n[1]+"]").after("<span class='inserted_text' style='color: blue'>"+h.showText+"</span>")}}}else{if(h.className=="org.neworiental.rmp.base::BasePicture"){if(l.children("img").length==0||l.children("img").attr("src")!=h.url){l.html("<img src='"+this.config.imgPath+h.url+"'/>")}if(h.isCenter=="true"){l.css("text-align","center")}else{l.css("text-align","left")}}else{if(h.className=="org.neworiental.rmp.base::BaseAudio"){l.html("<audio controls='controls'></audio>");if(h.soundURL){l.children("audio").attr("src",h.soundURL)}if(h.isCenter=="true"){l.css("text-align","center")}else{l.css("text-align","left")}}else{if(h.className=="org.neworiental.rmp.base::BaseVideo"){l.html("<video controls='controls'></video>");l.children("video").attr({width:h.vWidth+"px",height:h.vHeight+"px"});if(h.url){l.children("video").attr("src",h.url)}if(h.isCenter=="true"){l.css("text-align","center")}else{l.css("text-align","left")}}else{if(h.className=="org.neworiental.rmp.base::TOEFLRecord"){var F="<div class='subject_record'><div class='record_title'>Recording......</div><div class='record_time'><div></div><b></b></div><div class='record_progress'></div></div>";l.html(F);l.css("text-align","center");if(a.config.status=="testing"&&a.config.statusType!="review"){var I=parseInt(h.totalTime);var T=Math.floor(I/60);if(T<10){T="0"+T}var s=I%60;if(s<10){s="0"+s}l.find(".record_time").children("b").text(T+":"+s);Recorder.get(function(ah){var i=ah;if(i!=null){var ad=a.utils.newId();k.attr("recordId",ad);k.bind("submit",function(){i.upload("upload1?id="+ad)});i.start();var ae=new Date().getTime();var ac=l.find(".record_progress");var af=$("<div></div>").appendTo(ac);var ag=setInterval(function(){if(l.length==0||!l.is(":visible")){clearInterval(ag);i.stop();return}var aj=new Date().getTime();var ai=aj-ae;var an=Math.round(ai/1000);var al=Math.round(an/(h.totalTime)*100);var am=parseInt(h.totalTime);var ao=am-an;if(ao<=0){af.css("width","100%");l.find(".record_time").children("b").text("00:00");clearInterval(ag);l.trigger("ended");i.stop();l.find(".record_title").text("Recording......（100%）");return}af.css("width",an/am*100+"%");l.find(".record_title").text("Recording......（"+al+"%）");var ak=Math.floor(ao/60);if(ak<10){ak="0"+ak}var ap=ao%60;if(ap<10){ap="0"+ap}l.find(".record_time").children("b").text(ak+":"+ap)},250)}},{onRecording:function(ac){var i=ac[0]/0.2;if(i>1){i=1}l.find(".record_time").children("div").width(i*430+"px")}})}else{if(a.config.status=="testing"&&a.config.statusType=="review"&&Player.pageAnswer&&Player.pageAnswer.length>0){var n=Player.getSubjectAnswer(Player.pageAnswer,a.model.define,h);l.find(".record_title").text("Your Answer");l.append("<div><audio class='review_audio' style='width: 430px;' controls></audio></div>");l.find(".review_audio").bind("canplay",function(){var ae=$(this)[0];ae.play();var af=parseInt(h.totalTime);var i=Math.floor(ae.duration);var ah=af-i;if(ah>af){ah=af}else{if(ah<0){ah=0}}var ad=Math.floor(ah/60);if(ad<10){ad="0"+ad}var ai=ah%60;if(ai<10){ai="0"+ai}l.find(".record_time").children("b").text(ad+":"+ai);var ac=l.find(".record_progress");var ag=$("<div></div>").appendTo(ac);ag.css("width",i/af*430+"px")});l.find(".review_audio").attr("src","public/upload/record/"+n[1]+".mp3")}}}else{if(h.className=="org.neworiental.rmp.base::OptionGroup"){l.empty();var y=$("<ul class='subject_select_list'></ul>").appendTo(l);var C;if(h.isMult=="true"){C="<input type='checkbox' name='subject_select_radio' class='chk'/>"}else{C="<input type='radio' name='subject_select_radio' class='chk'/>"}if(h.options){for(var X=0;X<h.options.length;X++){var u=h.options[X];var G=$("<li></li>").appendTo(y);var O=a.utils.newId();var B=$(C).appendTo(G);B.attr("id",O);var W=$("<label>"+a.utils.toText(u.htmlText)+"</label>").appendTo(G);W.attr("for",O);B.attr("ind",X);if(a.config.status=="subject"&&h.rightAns){var K=JSON.parse(h.rightAns);if(K.indexOf(X)>=0){B.prop("checked",true)}}else{if(a.config.status=="testing"&&a.config.statusType=="normal"&&Player.pageAnswer&&Player.pageAnswer.length>0){var n=Player.getSubjectAnswer(Player.pageAnswer,a.model.define,h);if(n.indexOf(X)>=0){B.prop("checked",true)}}else{if(a.config.status=="testing"&&a.config.statusType=="review"){var K=JSON.parse(h.rightAns);if(K.indexOf(X)>=0){B.prop("checked",true)}if(Player.pageAnswer&&Player.pageAnswer.length>0){var n=Player.getSubjectAnswer(Player.pageAnswer,a.model.define,h);if(n.indexOf(X)>=0){if(K.indexOf(X)>=0){B.addClass("righted")}else{B.addClass("errored")}}}}}}}}if(h.isCenter=="true"){l.css("text-align","center")}else{l.css("text-align","left")}if(a.config.status=="subject"){y.find("input").bind("click",function(){var ac=y.find("input:checked").map(function(){return parseInt($(this).attr("ind"))}).get();var ad=y.parents(".subject_box").attr("id");var i=a.model.getById(ad);i.rightAnswer=ac;a.model.update(i)})}}else{if(h.className=="org.neworiental.rmp.base::BaseInputText"){l.empty();var N=$("<div class='subject_write_text'><textarea></textarea></div>").appendTo(l);var c=N.children("textarea");c.css("min-height",h.minHeight+"px");c.attr("placeholder",h.defaultText);if(h.hideCount=="false"){l.prepend("<div class='write_word_count'>Word Count: 0</div>")}c.unbind().bind("keyup",function(){$(this).scrollTop(999999);var ad=$(this).height()+$(this).scrollTop();$(this).height(ad);var i=$(this).parent().parent().parent().attr("id");var ac=a.model.getById(i);if(ac&&ac.hideCount=="false"){var af=$(this).val();var ag=af.split(/\s+/);var ae=ag.length;if(ae>=1){if(ag[ag.length-1]==""){ae=ae-1}}$(this).parent().parent().children(".write_word_count").text("Word Count: "+ae)}});c.trigger("keyup");if(a.config.status=="testing"){var n=Player.getSubjectAnswer(Player.pageAnswer,a.model.define,h);c.val(n[1]).trigger("keyup")}}else{if(h.className=="org.neworiental.rmp.base::TOEFLTimerViewer"){var F="<div class='subject_timer'><div class='timer_title'>"+h.title+"</div><div class='timer_time'></div><div class='timer_progress'></div></div>";l.html(F);var T=Math.floor(h.time/60);if(T<10){T="0"+T}var s=h.time%60;if(s<10){s="0"+s}l.find(".timer_time").text(T+":"+s);if(h.isCenter=="true"){l.css("text-align","center")}else{l.css("text-align","left")}if(a.config.status=="testing"){var r=new Date().getTime();var D=l.find(".timer_progress");var U=$("<div></div>").appendTo(D);var Q=setInterval(function(){if(l.length==0||!l.is(":visible")){clearInterval(Q);return}var i=new Date().getTime();var ad=Math.round((i-r)/1000);var ae=h.time-ad;if(ae<=0){U.css("width","100%");l.find(".timer_time").text("00:00");clearInterval(Q);l.trigger("ended");return}U.css("width",ad/h.time*100+"%");var ac=Math.floor(ae/60);if(ac<10){ac="0"+ac}var af=ae%60;if(af<10){af="0"+af}l.find(".timer_time").text(ac+":"+af)},250)}}else{if(h.className=="org.neworiental.rmp.base::TOEFLTable"){var F="<table class='subject_tableselect'>";F+="<tr class='table_select_header'>";F+="<td></td>";var w="";var q=JSON.parse(h.columns);for(var X=0;X<q.length;X++){F+="<td>";F+=q[X];F+="</td>";w+="<td class='tableselect_chkbox' ind='"+X+"'></td>"}F+="</tr>";var Z=JSON.parse(h.rows);for(var X=0;X<Z.length;X++){F+="<tr>";F+="<td>";F+=Z[X];F+="</td>";F+=w;F+="</tr>"}F+="</table>";l.html(F);if(h.isCenter=="true"){l.children("table").css("margin","0px auto")}else{l.children("table").css("margin","0px")}if(a.config.status=="subject"&&h.rightAnswer){var Z=l.find("tr:not(.table_select_header)");var Y=0;Z.each(function(){var i=h.rightAnswer[Y];if(i>=0){$(this).children(".tableselect_chkbox:eq("+i+")").addClass("table_checked")}Y++})}else{if(a.config.status=="testing"&&a.config.statusType=="review"&&Player.pageAnswer&&Player.pageAnswer.length>0){var n=Player.getSubjectAnswer(Player.pageAnswer,a.model.define,h);var Z=l.find("tr:not(.table_select_header)");var Y=1;Z.each(function(){var i=n[Y];if(i>=0){$(this).children(".tableselect_chkbox:eq("+i+")").addClass("table_checked")}Y++})}}var o=a.config.status=="testing"&&a.config.statusType=="review";if(!o){l.find(".tableselect_chkbox").unbind().bind("click",function(){$(this).parent().children().removeClass("table_checked");$(this).addClass("table_checked");if(a.config.status=="subject"){var ac=l.find("tr:not(.table_select_header)");var ad=[];ac.each(function(){var ag=-1;var af=$(this).children(".table_checked");if(af.length){ag=parseInt(af.attr("ind"))}ad.push(ag)});var ae=l.parents(".subject_box").attr("id");var i=a.model.getById(ae);i.rightAnswer=ad;a.model.update(i)}})}}else{if(h.className=="org.neworiental.rmp.base::TOEFLReadingDrag"){l.empty();var L=h.blankNum.split("*^*");var J=h.blankDescs.split("*^*");var V=0;for(var X=0;X<L.length;X++){var P=$("<div></div>").appendTo(l);if(X!=0){P.css("padding-top","20px")}var z=parseInt(L[X]);var p=J[X];if(p){P.append("<div>"+p+"</div>")}if(a.config.status=="testing"&&!h.answer){var n=Player.getSubjectAnswer(Player.pageAnswer,a.model.define,h);h.answer=[];for(var X=1;X<n.length;X++){h.answer.push(n[X])}}var aa=0;while(aa<z){var t=$("<div class='subjectdrag_blank'></div>").appendTo(P);if(a.config.status=="subject"&&h.rightAnswer){var v=h.rightAnswer[V];if(v>=0){t.html(this.utils.toText(h.options[v]));t.attr("an",v)}}else{if(a.config.status=="testing"){var v=h.answer[V];if(v>=0){t.html(this.utils.toText(h.options[v]));t.attr("an",v)}}}aa++;V++}}for(var X=0;X<h.options.length;X++){var R=h.options[X];if(a.config.status=="subject"&&h.rightAnswer){if(h.rightAnswer.indexOf(X)<0){l.append("<div class='subjectdrag_option' ind='"+X+"'>"+this.utils.toText(h.options[X])+"</div>")}}else{if(a.config.status=="testing"){if(h.answer.indexOf(X)<0){l.append("<div class='subjectdrag_option' ind='"+X+"'>"+this.utils.toText(h.options[X])+"</div>")}}else{l.append("<div class='subjectdrag_option' ind='"+X+"'>"+this.utils.toText(h.options[X])+"</div>")}}}if(a.config.status=="subject"||(a.config.status=="testing"&&a.config.statusType=="normal")){l.children(".subjectdrag_option").unbind().bind("mousedown",function(ad){var ac=$(this);var i=ad.pageX-ac.offset().left;var af=ad.pageY-ac.offset().top;var ae=ac.clone().appendTo("body");ae.css({position:"absolute","margin-top":"0px",background:"transparent"});ae.width(ac.width());$(document).bind("mousemove.sub_drag",function(ag){ae.css({left:ag.pageX-i,top:ag.pageY-af})});$(document).bind("mouseup.sub_drag",function(ah){var aj=ah.pageX;var ai=ah.pageY;var ag=0;var al=null;l.find(".subjectdrag_blank").each(function(){var an=$(this);var am={x:an.offset().left,y:an.offset().top,w:an.outerWidth(),h:an.outerHeight()};if(a.utils.pointInRect(aj,ai,am)){al=an;return false}ag++});if(al!=null){al.attr("an",ae.attr("ind"));if(a.config.status=="subject"||a.config.status=="testing"){var ak=[];l.find(".subjectdrag_blank").each(function(){var am=-1;if($(this).attr("an")){am=parseInt($(this).attr("an"))}ak.push(am)});if(a.config.status=="testing"){h.answer=ak}else{h.rightAnswer=ak}a.model.update(h);a.renderSubject(h)}}ae.remove();$(document).unbind("mouseup.sub_drag");$(document).unbind("mousemove.sub_drag")})})}}else{if(h.className=="org.neworiental.rmp.base::TOEFLRecordChecker"){var F="<div class='subject_record_test'><audio autoplay></audio><div class='record_test_line'>Select Microphone<div class='tpbtn drop record_test_select'>Default</div><input type='button' class='tpbtn record_btn' style='width: 90px' value='Recording'/><input type='button' class='tpbtn stop_btn' style='width: 70px' value='Stop' disabled='disabled'/></div><div class='record_test_line record_test_line2'><div class='record_test_progress'><div></div><b>您可以测试麦克风了！</b></div><input type='button' class='tpbtn play_btn' style='width: 90px' value='Play' disabled='disabled'/><input type='button' class='tpbtn' style='width: 70px' value='ReTry' disabled='disabled'/></div></div>";l.html(F);l.css("text-align","center");if(a.config.status=="testing"&&a.config.statusType!="review"){var ab=null;l.find(".record_btn").bind("click",function(){Recorder.get(function(i){ab=i;if(ab!=null){ab.start();l.find(".tpbtn").prop("disabled","disabled");l.find(".stop_btn").prop("disabled",false)}},{onRecording:function(ac){var i=ac[0]/0.2;if(i>1){i=1}l.find(".record_test_progress").children("div").width(i*360+"px")}})});l.find(".stop_btn").bind("click",function(){if(ab!=null){ab.stop();l.find(".record_test_progress").children("div").width("0px");l.find(".tpbtn").prop("disabled","disabled");l.find(".record_btn").prop("disabled",false);l.find(".play_btn").prop("disabled",false)}});l.find(".play_btn").bind("click",function(){if(ab!=null){var i=l.find("audio")[0];ab.play(i)}})}}else{if(h.className=="org.neworiental.rmp.base::ToelfAudio"){l.html("<div class='subject_audiotext'><div class='subject_audiotext_progress'></div></div>");if(this.config.status=="template"||this.config.status=="subject"){l.children().append("<div class='subject_audiotext_tip'>编辑模式不能播放，可预览查看...</div>")}l.css("text-align","center");if(a.config.status=="testing"){var m=JSON.parse(h.mode);var x=Player.items[Player.itemIndex];if(x.item.subjectType=="TOEFL_LISTEN"&&m.length==0){l.find(".subject_audiotext_progress").hide()}else{l.children().append("<div class='subject_audiotext_tip'>加载中，请稍候...</div>")}var A=$("<audio></audio>").appendTo(l);A.bind("canplay",function(){l.find(".subject_audiotext_tip").remove();var ad=$(this)[0];ad.play();var ac=l.find(".subject_audiotext_progress");var ae=$("<div></div>").appendTo(ac);var i=-1;var af=setInterval(function(){if(l.length==0||!l.is(":visible")){clearInterval(af);return}var ai=Math.floor(ad.currentTime);ae.css("width",ad.currentTime/ad.duration*400+"px");if(ad.currentTime>=ad.duration){clearInterval(af);return}if(ai==i){return}i=ai;for(var ak=0;ak<m.length;ak++){var ag=m[ak];var aj=Math.floor(ag.timestamp/1000);if(ai==aj){if(ag.isWord&&ag.word){l.find(".audiotext_view").remove();var ah=$("<div class='audiotext_view'><div></div></div>").prependTo(l);ah.children("div").append("<span>"+ag.word+"</span>")}else{if(ag.url){l.find(".audiotext_view").remove();var ah=$("<div class='audiotext_view audiotext_nobor'></div>").prependTo(l);ah.append("<img src='"+(a.config.audioImgPath+ag.url)+"'/>")}}}else{if(ag.type=="end"&&ag.time==ai){l.find(".audiotext_view").remove()}}}},100)});if(h.url){A.attr("src",this.config.audioPath+h.url)}}}else{if(h.className=="fillblank"){l.html(h.text);l.find(".fillblank_blank").unbind().bind("keyup",function(){var i=$("#test_blank_w");if(i.length==0){i=$("<div class='fillblank_blank' style='width: auto;position: absolute; left: -500px'></div>").appendTo("body")}i.text($(this).val());$(this).css("width",i.width())});l.find(".fillblank_blank").trigger("keyup")}}}}}}}}}}}}}}}if(!e){k.css({"margin-left":h.leftDis+"px","margin-top":h.topDis+"px"})}return k};this.open=function(g){if(typeof g=="string"){g=JSON.parse(g)}this.model.define=g;var k=this.config.target;k.find(".subject_page").remove();if(g.containers.length==1){k.append("<div class='subject_page'><div class='designer_canvas' pindex='0'></div></div>")}else{var e=$("<div class='subject_page'><div class='designer_canvas' pindex='0'></div></div>").appendTo(k);var b=$("<div class='subject_page'><div class='designer_canvas' pindex='1'></div></div>").appendTo(k);e.css({"float":"left",width:"45%","margin-left":"3%"});b.css({"float":"left",width:"45%","margin-left":"4%"})}k.find(".subject_page").height(this.config.pageHeight);for(var h=0;h<g.containers.length;h++){var d=g.containers[h];if(d.contents){for(var f=0;f<d.contents.length;f++){var c=d.contents[f];this.renderSubject(c)}}}if(this.config.status=="template"){}else{if(this.config.status=="subject"){if(g.isExplain=="true"){$("#chk_des_page").prop("checked",true)}else{$("#chk_des_page").prop("checked",false)}if(g.time){$("#input_page_time").val(g.time)}else{$("#input_page_time").val("")}var j="normal";if(g.slidingType){j=g.slidingType}var l=$("#menu_turning").children("li[ty="+j+"]").text();$("#btn_turning_select").text(l);$(".bgaudio_player").attr("src",g.url)}else{if(this.config.status=="testing"){}}}},this.toggleAdditional=function(b){var c=this.config.target;if(b){c.find(".subject_page:eq(0)").hide();c.find(".subject_page:eq(1)").show()}else{c.find(".subject_page:eq(1)").hide();c.find(".subject_page:eq(0)").show()}},this.model={define:{horizentalCenter:"NaN",time:"0",className:"org.neworiental.rmp.base::Group",verticalCenter:"NaN",rightDis:"NaN",version:"3.0",isNode:"false",url:"",topDis:"NaN",isExplain:"false",ID:"",slidingType:"normal_mode",leftDis:"NaN",bottomDis:"NaN",containers:[{horizentalCenter:"NaN",className:"org.neworiental.rmp.base::BaseContainer",verticalCenter:"NaN",topDis:"NaN",rightDis:"NaN",ID:"",leftDis:"NaN",isNode:"false",bottomDis:"NaN",contents:[]}]},create:function(c){var b={ID:a.utils.newId(),className:c,horizentalCenter:"NaN",verticalCenter:"NaN",topDis:"20",rightDis:"20",leftDis:"40",bottomDis:"0",isNode:"false"};if(c=="org.neworiental.rmp.base::BaseRichTxt"){b.htmlText="在此输入普通文本"}else{if(c=="org.neworiental.rmp.base::BaseTLFText"){b.text=encodeURIComponent("在此输入富文本")}else{if(c=="org.neworiental.rmp.base::BasePicture"){b.isCenter="false";b.url="static/images/img.png"}else{if(c=="org.neworiental.rmp.base::BaseAudio"){b.isCenter="false";b.soundURL=""}else{if(c=="org.neworiental.rmp.base::BaseVideo"){b.isCenter="false";b.vWidth="400";b.vHeight="400";b.url=""}else{if(c=="org.neworiental.rmp.base::TOEFLRecord"){b.sourceMark="0";b.testPointName="";b.testPointID="";b.subjectiveItem="true";b.sourceMark="0";b.rightAns='[""]';b.totalTime="60"}else{if(c=="org.neworiental.rmp.base::OptionGroup"){b.layoutMode="0";b.isMult="false";b.markLogic="0";b.sourceMark="1";b.isCenter="false";b.testPointName="";b.testPointID="";b.subjectiveItem="false";b.options=[{horizentalCenter:"NaN",className:"org.neworiental.rmp.base::BaseRichTxt",verticalCenter:"NaN",topDis:"NaN",rightDis:"0",ID:"",htmlText:"选项",leftDis:"30",isNode:"false",bottomDis:"NaN"},{horizentalCenter:"NaN",className:"org.neworiental.rmp.base::BaseRichTxt",verticalCenter:"NaN",topDis:"NaN",rightDis:"0",ID:"",htmlText:"选项",leftDis:"30",isNode:"false",bottomDis:"NaN"},{horizentalCenter:"NaN",className:"org.neworiental.rmp.base::BaseRichTxt",verticalCenter:"NaN",topDis:"NaN",rightDis:"0",ID:"",htmlText:"选项",leftDis:"30",isNode:"false",bottomDis:"NaN"},{horizentalCenter:"NaN",className:"org.neworiental.rmp.base::BaseRichTxt",verticalCenter:"NaN",topDis:"NaN",rightDis:"0",ID:"",htmlText:"选项",leftDis:"30",isNode:"false",bottomDis:"NaN"}]}else{if(c=="write"){b.placeholder="请在此输入...";b.minHeight=200;b.showCount=true}else{if(c=="org.neworiental.rmp.base::TOEFLTimerViewer"){b.title="No Title";b.time="60";b.isCenter="false"}else{if(c=="tableselect"){b.rows=["ClimateCharts","Interviews with meteorologists","Journals notes"];b.columns=["Include report","Not include in report"]}else{if(c=="drag"){b.blanks=[{size:2,description:""}];b.options=["Ecologists now think that the stability of an environment is a result of diversity rather than patchiness.","Patchy environments that vary from place to place do not often have high species diversity.","A patchy environment is thought to increase stability because it is able to support a wide variety of organisms."]}else{if(c=="fillblank"){b.text='<p style="text-align: center;"><b>Title in this</b></p><p style="text-align: left;">So muttered the White Rabbit just before<input class="fillblank_blank" type="text">he plunged into Wonderlan with Alic</p>'}else{if(c=="audiotext"){b.points=[]}}}}}}}}}}}}}return b},add:function(f,c,d){var g=this.define.containers[c].contents;if(typeof d=="undefined"||d==-1||d>=g.length){g.push(f)}else{var b=[];for(var e=0;e<g.length;e++){if(e==d){b.push(f)}b.push(g[e])}this.define.containers[c].contents=b}},update:function(c){for(var f=0;f<this.define.containers.length;f++){var e=this.define.containers[f];for(var b=0;b<e.contents.length;b++){var d=e.contents[b];if(d.ID==c.ID){e.contents[b]=c}}}},remove:function(e){for(var f=0;f<this.define.containers.length;f++){var d=this.define.containers[f];for(var b=0;b<d.contents.length;b++){var c=d.contents[b];if(c.ID==e){d.contents.splice(b,1);return}}}},getById:function(f){for(var e=0;e<this.define.containers.length;e++){var d=this.define.containers[e];for(var b=0;b<d.contents.length;b++){var c=d.contents[b];if(c.ID==f){return c}}}return null},getSubContainerIndex:function(f){for(var e=0;e<this.define.containers.length;e++){var d=this.define.containers[e];if(d.contents){for(var b=0;b<d.contents.length;b++){var c=d.contents[b];if(c.ID==f){return e}}}}return 0},getByClassName:function(e){var b=[];for(var g=0;g<this.define.containers.length;g++){var f=this.define.containers[g];if(f.contents){for(var c=0;c<f.contents.length;c++){var d=f.contents[c];if(d.className==e){b.push(d)}}}}return b}};this.utils={getRelativePos:function(d,c,e){var b=e.offset();if(b==null){b={left:0,top:0}}return{x:d-b.left+e.scrollLeft(),y:c-b.top+e.scrollTop()}},newId:function(){var b=new UUID().id;return b},pointInRect:function(c,b,d){if(c>=d.x&&c<=d.x+d.w&&b>=d.y&&b<=d.y+d.h){return true}return false},removeFromArray:function(d,c){var b=d.indexOf(c);if(b>=0){d.splice(b,1)}return d},addToSet:function(d,c){var b=d.indexOf(c);if(b<0){d.push(c)}return d},mergeArray:function(c,b){for(var d=0;d<b.length;d++){var e=b[d];if(c.indexOf(e)<0){c.push(e)}}return c},copy:function(b){return $.extend(true,{},b)},toText:function(c){var b=$("#text_convertor");if(b.length==0){b=$("<div id='text_convertor' style='display:none'></div>").appendTo("body")}b.html(c);return b.text()},formatHtml:function(f){var d=$("#text_convertor");if(d.length==0){d=$("<div id='text_convertor' style='display:none'></div>").appendTo("body")}d.html(f);var i=d.find("textflow");var b=d.find("textformat");i.css("display","block");i.each(function(){var j=$(this);if(j.attr("paddingbottom")){j.css("padding-bottom",j.attr("paddingbottom")+"px")}if(j.attr("paddingleft")){j.css("padding-left",j.attr("paddingleft")+"px")}if(j.attr("paddingtop")){j.css("padding-top",j.attr("paddingtop")+"px")}if(j.attr("paddingright")){j.css("padding-right",j.attr("paddingright")+"px")}});var g=d.find("p");g.each(function(){var j=$(this);if(j.attr("textalign")){j.css("text-align",j.attr("textalign"))}if(j.attr("textindent")){j.css("text-indent",j.attr("textindent")+"px")}});var e=d.find("span");e.each(function(){var j=$(this);if(j.attr("color")){j.css("color",j.attr("color"))}if(j.attr("fontfamily")){j.css("font-family",j.attr("fontfamily"))}if(j.attr("fontstyle")){j.css("font-style",j.attr("fontstyle"))}if(j.attr("fontweight")){j.css("font-weight",j.attr("fontweight"))}if(j.attr("textdecoration")){j.css("text-decoration",j.attr("textdecoration"))}if(j.attr("fontsize")){j.css("font-size",j.attr("fontsize")+"px")}});var h=d.find("font");h.each(function(){var j=$(this);if(j.attr("size")){j.css("font-size",j.attr("size")+"px")}if(j.attr("face")){j.css("font-family",j.attr("face"))}});var c=d.find("img[source]");c.each(function(){var j=$(this);var k=j.attr("source");if(k.indexOf("org.neworiental.rmp.base.tlf.tab::CommentTab")>=0){j.after('<input class="richtext_arrow" readonly="readonly">')}else{if(k.indexOf("org.neworiental.rmp.base.tlf.tab::ToelfInsertTab")>=0){j.after('<input class="richtext_rect" readonly="readonly">')}else{if(k.indexOf("org.neworiental.rmp.base.tlf.tab::HeadSetTab")>=0){j.after('<input class="richtext_headset" readonly="readonly">')}}}});return d.html()}};this.initialize.apply(this,arguments)};